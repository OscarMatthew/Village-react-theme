{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.File = exports.Link = exports.Node = exports.SEP = void 0;\n\nvar process_1 = require(\"./process\");\n\nvar buffer_1 = require(\"./internal/buffer\");\n\nvar constants_1 = require(\"./constants\");\n\nvar events_1 = require(\"events\");\n\nvar Stats_1 = require(\"./Stats\");\n\nvar S_IFMT = constants_1.constants.S_IFMT,\n    S_IFDIR = constants_1.constants.S_IFDIR,\n    S_IFREG = constants_1.constants.S_IFREG,\n    S_IFLNK = constants_1.constants.S_IFLNK,\n    O_APPEND = constants_1.constants.O_APPEND;\nexports.SEP = '/';\n/**\n * Node in a file system (like i-node, v-node).\n */\n\nvar Node =\n/** @class */\nfunction (_super) {\n  __extends(Node, _super);\n\n  function Node(ino, perm) {\n    if (perm === void 0) {\n      perm = 438;\n    }\n\n    var _this = _super.call(this) || this; // User ID and group ID.\n\n\n    _this.uid = process_1.default.getuid();\n    _this.gid = process_1.default.getgid();\n    _this.atime = new Date();\n    _this.mtime = new Date();\n    _this.ctime = new Date();\n    _this.perm = 438; // Permissions `chmod`, `fchmod`\n\n    _this.mode = S_IFREG; // S_IFDIR, S_IFREG, etc.. (file by default?)\n    // Number of hard links pointing at this Node.\n\n    _this.nlink = 1;\n    _this.perm = perm;\n    _this.mode |= perm;\n    _this.ino = ino;\n    return _this;\n  }\n\n  Node.prototype.getString = function (encoding) {\n    if (encoding === void 0) {\n      encoding = 'utf8';\n    }\n\n    return this.getBuffer().toString(encoding);\n  };\n\n  Node.prototype.setString = function (str) {\n    // this.setBuffer(bufferFrom(str, 'utf8'));\n    this.buf = (0, buffer_1.bufferFrom)(str, 'utf8');\n    this.touch();\n  };\n\n  Node.prototype.getBuffer = function () {\n    if (!this.buf) this.setBuffer((0, buffer_1.bufferAllocUnsafe)(0));\n    return (0, buffer_1.bufferFrom)(this.buf); // Return a copy.\n  };\n\n  Node.prototype.setBuffer = function (buf) {\n    this.buf = (0, buffer_1.bufferFrom)(buf); // Creates a copy of data.\n\n    this.touch();\n  };\n\n  Node.prototype.getSize = function () {\n    return this.buf ? this.buf.length : 0;\n  };\n\n  Node.prototype.setModeProperty = function (property) {\n    this.mode = this.mode & ~S_IFMT | property;\n  };\n\n  Node.prototype.setIsFile = function () {\n    this.setModeProperty(S_IFREG);\n  };\n\n  Node.prototype.setIsDirectory = function () {\n    this.setModeProperty(S_IFDIR);\n  };\n\n  Node.prototype.setIsSymlink = function () {\n    this.setModeProperty(S_IFLNK);\n  };\n\n  Node.prototype.isFile = function () {\n    return (this.mode & S_IFMT) === S_IFREG;\n  };\n\n  Node.prototype.isDirectory = function () {\n    return (this.mode & S_IFMT) === S_IFDIR;\n  };\n\n  Node.prototype.isSymlink = function () {\n    // return !!this.symlink;\n    return (this.mode & S_IFMT) === S_IFLNK;\n  };\n\n  Node.prototype.makeSymlink = function (steps) {\n    this.symlink = steps;\n    this.setIsSymlink();\n  };\n\n  Node.prototype.write = function (buf, off, len, pos) {\n    if (off === void 0) {\n      off = 0;\n    }\n\n    if (len === void 0) {\n      len = buf.length;\n    }\n\n    if (pos === void 0) {\n      pos = 0;\n    }\n\n    if (!this.buf) this.buf = (0, buffer_1.bufferAllocUnsafe)(0);\n\n    if (pos + len > this.buf.length) {\n      var newBuf = (0, buffer_1.bufferAllocUnsafe)(pos + len);\n      this.buf.copy(newBuf, 0, 0, this.buf.length);\n      this.buf = newBuf;\n    }\n\n    buf.copy(this.buf, pos, off, off + len);\n    this.touch();\n    return len;\n  }; // Returns the number of bytes read.\n\n\n  Node.prototype.read = function (buf, off, len, pos) {\n    if (off === void 0) {\n      off = 0;\n    }\n\n    if (len === void 0) {\n      len = buf.byteLength;\n    }\n\n    if (pos === void 0) {\n      pos = 0;\n    }\n\n    if (!this.buf) this.buf = (0, buffer_1.bufferAllocUnsafe)(0);\n    var actualLen = len;\n\n    if (actualLen > buf.byteLength) {\n      actualLen = buf.byteLength;\n    }\n\n    if (actualLen + pos > this.buf.length) {\n      actualLen = this.buf.length - pos;\n    }\n\n    this.buf.copy(buf, off, pos, pos + actualLen);\n    return actualLen;\n  };\n\n  Node.prototype.truncate = function (len) {\n    if (len === void 0) {\n      len = 0;\n    }\n\n    if (!len) this.buf = (0, buffer_1.bufferAllocUnsafe)(0);else {\n      if (!this.buf) this.buf = (0, buffer_1.bufferAllocUnsafe)(0);\n\n      if (len <= this.buf.length) {\n        this.buf = this.buf.slice(0, len);\n      } else {\n        var buf = (0, buffer_1.bufferAllocUnsafe)(0);\n        this.buf.copy(buf);\n        buf.fill(0, len);\n      }\n    }\n    this.touch();\n  };\n\n  Node.prototype.chmod = function (perm) {\n    this.perm = perm;\n    this.mode = this.mode & ~511 | perm;\n    this.touch();\n  };\n\n  Node.prototype.chown = function (uid, gid) {\n    this.uid = uid;\n    this.gid = gid;\n    this.touch();\n  };\n\n  Node.prototype.touch = function () {\n    this.mtime = new Date();\n    this.emit('change', this);\n  };\n\n  Node.prototype.canRead = function (uid, gid) {\n    if (uid === void 0) {\n      uid = process_1.default.getuid();\n    }\n\n    if (gid === void 0) {\n      gid = process_1.default.getgid();\n    }\n\n    if (this.perm & 4\n    /* IROTH */\n    ) {\n      return true;\n    }\n\n    if (gid === this.gid) {\n      if (this.perm & 32\n      /* IRGRP */\n      ) {\n        return true;\n      }\n    }\n\n    if (uid === this.uid) {\n      if (this.perm & 256\n      /* IRUSR */\n      ) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  Node.prototype.canWrite = function (uid, gid) {\n    if (uid === void 0) {\n      uid = process_1.default.getuid();\n    }\n\n    if (gid === void 0) {\n      gid = process_1.default.getgid();\n    }\n\n    if (this.perm & 2\n    /* IWOTH */\n    ) {\n      return true;\n    }\n\n    if (gid === this.gid) {\n      if (this.perm & 16\n      /* IWGRP */\n      ) {\n        return true;\n      }\n    }\n\n    if (uid === this.uid) {\n      if (this.perm & 128\n      /* IWUSR */\n      ) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  Node.prototype.del = function () {\n    this.emit('delete', this);\n  };\n\n  Node.prototype.toJSON = function () {\n    return {\n      ino: this.ino,\n      uid: this.uid,\n      gid: this.gid,\n      atime: this.atime.getTime(),\n      mtime: this.mtime.getTime(),\n      ctime: this.ctime.getTime(),\n      perm: this.perm,\n      mode: this.mode,\n      nlink: this.nlink,\n      symlink: this.symlink,\n      data: this.getString()\n    };\n  };\n\n  return Node;\n}(events_1.EventEmitter);\n\nexports.Node = Node;\n/**\n * Represents a hard link that points to an i-node `node`.\n */\n\nvar Link =\n/** @class */\nfunction (_super) {\n  __extends(Link, _super);\n\n  function Link(vol, parent, name) {\n    var _this = _super.call(this) || this;\n\n    _this.children = {}; // Path to this node as Array: ['usr', 'bin', 'node'].\n\n    _this._steps = []; // \"i-node\" number of the node.\n\n    _this.ino = 0; // Number of children.\n\n    _this.length = 0;\n    _this.vol = vol;\n    _this.parent = parent;\n    _this.name = name;\n\n    _this.syncSteps();\n\n    return _this;\n  }\n\n  Object.defineProperty(Link.prototype, \"steps\", {\n    get: function () {\n      return this._steps;\n    },\n    // Recursively sync children steps, e.g. in case of dir rename\n    set: function (val) {\n      this._steps = val;\n\n      for (var _i = 0, _a = Object.values(this.children); _i < _a.length; _i++) {\n        var child = _a[_i];\n        child === null || child === void 0 ? void 0 : child.syncSteps();\n      }\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  Link.prototype.setNode = function (node) {\n    this.node = node;\n    this.ino = node.ino;\n  };\n\n  Link.prototype.getNode = function () {\n    return this.node;\n  };\n\n  Link.prototype.createChild = function (name, node) {\n    if (node === void 0) {\n      node = this.vol.createNode();\n    }\n\n    var link = new Link(this.vol, this, name);\n    link.setNode(node);\n\n    if (node.isDirectory()) {// link.setChild('.', link);\n      // link.getNode().nlink++;\n      // link.setChild('..', this);\n      // this.getNode().nlink++;\n    }\n\n    this.setChild(name, link);\n    return link;\n  };\n\n  Link.prototype.setChild = function (name, link) {\n    if (link === void 0) {\n      link = new Link(this.vol, this, name);\n    }\n\n    this.children[name] = link;\n    link.parent = this;\n    this.length++;\n    this.emit('child:add', link, this);\n    return link;\n  };\n\n  Link.prototype.deleteChild = function (link) {\n    delete this.children[link.getName()];\n    this.length--;\n    this.emit('child:delete', link, this);\n  };\n\n  Link.prototype.getChild = function (name) {\n    if (Object.hasOwnProperty.call(this.children, name)) {\n      return this.children[name];\n    }\n  };\n\n  Link.prototype.getPath = function () {\n    return this.steps.join(exports.SEP);\n  };\n\n  Link.prototype.getName = function () {\n    return this.steps[this.steps.length - 1];\n  }; // del() {\n  //     const parent = this.parent;\n  //     if(parent) {\n  //         parent.deleteChild(link);\n  //     }\n  //     this.parent = null;\n  //     this.vol = null;\n  // }\n\n  /**\n   * Walk the tree path and return the `Link` at that location, if any.\n   * @param steps {string[]} Desired location.\n   * @param stop {number} Max steps to go into.\n   * @param i {number} Current step in the `steps` array.\n   *\n   * @return {Link|null}\n   */\n\n\n  Link.prototype.walk = function (steps, stop, i) {\n    if (stop === void 0) {\n      stop = steps.length;\n    }\n\n    if (i === void 0) {\n      i = 0;\n    }\n\n    if (i >= steps.length) return this;\n    if (i >= stop) return this;\n    var step = steps[i];\n    var link = this.getChild(step);\n    if (!link) return null;\n    return link.walk(steps, stop, i + 1);\n  };\n\n  Link.prototype.toJSON = function () {\n    return {\n      steps: this.steps,\n      ino: this.ino,\n      children: Object.keys(this.children)\n    };\n  };\n\n  Link.prototype.syncSteps = function () {\n    this.steps = this.parent ? this.parent.steps.concat([this.name]) : [this.name];\n  };\n\n  return Link;\n}(events_1.EventEmitter);\n\nexports.Link = Link;\n/**\n * Represents an open file (file descriptor) that points to a `Link` (Hard-link) and a `Node`.\n */\n\nvar File =\n/** @class */\nfunction () {\n  /**\n   * Open a Link-Node pair. `node` is provided separately as that might be a different node\n   * rather the one `link` points to, because it might be a symlink.\n   * @param link\n   * @param node\n   * @param flags\n   * @param fd\n   */\n  function File(link, node, flags, fd) {\n    /**\n     * A cursor/offset position in a file, where data will be written on write.\n     * User can \"seek\" this position.\n     */\n    this.position = 0;\n    this.link = link;\n    this.node = node;\n    this.flags = flags;\n    this.fd = fd;\n  }\n\n  File.prototype.getString = function (encoding) {\n    if (encoding === void 0) {\n      encoding = 'utf8';\n    }\n\n    return this.node.getString();\n  };\n\n  File.prototype.setString = function (str) {\n    this.node.setString(str);\n  };\n\n  File.prototype.getBuffer = function () {\n    return this.node.getBuffer();\n  };\n\n  File.prototype.setBuffer = function (buf) {\n    this.node.setBuffer(buf);\n  };\n\n  File.prototype.getSize = function () {\n    return this.node.getSize();\n  };\n\n  File.prototype.truncate = function (len) {\n    this.node.truncate(len);\n  };\n\n  File.prototype.seekTo = function (position) {\n    this.position = position;\n  };\n\n  File.prototype.stats = function () {\n    return Stats_1.default.build(this.node);\n  };\n\n  File.prototype.write = function (buf, offset, length, position) {\n    if (offset === void 0) {\n      offset = 0;\n    }\n\n    if (length === void 0) {\n      length = buf.length;\n    }\n\n    if (typeof position !== 'number') position = this.position;\n    if (this.flags & O_APPEND) position = this.getSize();\n    var bytes = this.node.write(buf, offset, length, position);\n    this.position = position + bytes;\n    return bytes;\n  };\n\n  File.prototype.read = function (buf, offset, length, position) {\n    if (offset === void 0) {\n      offset = 0;\n    }\n\n    if (length === void 0) {\n      length = buf.byteLength;\n    }\n\n    if (typeof position !== 'number') position = this.position;\n    var bytes = this.node.read(buf, offset, length, position);\n    this.position = position + bytes;\n    return bytes;\n  };\n\n  File.prototype.chmod = function (perm) {\n    this.node.chmod(perm);\n  };\n\n  File.prototype.chown = function (uid, gid) {\n    this.node.chown(uid, gid);\n  };\n\n  return File;\n}();\n\nexports.File = File;","map":{"version":3,"sources":["/Users/soladev/Desktop/react-solasite/node_modules/memfs/lib/node.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","constructor","create","defineProperty","exports","value","File","Link","Node","SEP","process_1","require","buffer_1","constants_1","events_1","Stats_1","S_IFMT","constants","S_IFDIR","S_IFREG","S_IFLNK","O_APPEND","_super","ino","perm","_this","uid","default","getuid","gid","getgid","atime","Date","mtime","ctime","mode","nlink","getString","encoding","getBuffer","toString","setString","str","buf","bufferFrom","touch","setBuffer","bufferAllocUnsafe","getSize","length","setModeProperty","property","setIsFile","setIsDirectory","setIsSymlink","isFile","isDirectory","isSymlink","makeSymlink","steps","symlink","write","off","len","pos","newBuf","copy","read","byteLength","actualLen","truncate","slice","fill","chmod","chown","emit","canRead","canWrite","del","toJSON","getTime","data","EventEmitter","vol","parent","name","children","_steps","syncSteps","get","set","val","_i","_a","values","child","enumerable","configurable","setNode","node","getNode","createChild","createNode","link","setChild","deleteChild","getName","getChild","getPath","join","walk","stop","i","step","keys","concat","flags","fd","position","seekTo","stats","build","offset","bytes"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.File = exports.Link = exports.Node = exports.SEP = void 0;\nvar process_1 = require(\"./process\");\nvar buffer_1 = require(\"./internal/buffer\");\nvar constants_1 = require(\"./constants\");\nvar events_1 = require(\"events\");\nvar Stats_1 = require(\"./Stats\");\nvar S_IFMT = constants_1.constants.S_IFMT, S_IFDIR = constants_1.constants.S_IFDIR, S_IFREG = constants_1.constants.S_IFREG, S_IFLNK = constants_1.constants.S_IFLNK, O_APPEND = constants_1.constants.O_APPEND;\nexports.SEP = '/';\n/**\n * Node in a file system (like i-node, v-node).\n */\nvar Node = /** @class */ (function (_super) {\n    __extends(Node, _super);\n    function Node(ino, perm) {\n        if (perm === void 0) { perm = 438; }\n        var _this = _super.call(this) || this;\n        // User ID and group ID.\n        _this.uid = process_1.default.getuid();\n        _this.gid = process_1.default.getgid();\n        _this.atime = new Date();\n        _this.mtime = new Date();\n        _this.ctime = new Date();\n        _this.perm = 438; // Permissions `chmod`, `fchmod`\n        _this.mode = S_IFREG; // S_IFDIR, S_IFREG, etc.. (file by default?)\n        // Number of hard links pointing at this Node.\n        _this.nlink = 1;\n        _this.perm = perm;\n        _this.mode |= perm;\n        _this.ino = ino;\n        return _this;\n    }\n    Node.prototype.getString = function (encoding) {\n        if (encoding === void 0) { encoding = 'utf8'; }\n        return this.getBuffer().toString(encoding);\n    };\n    Node.prototype.setString = function (str) {\n        // this.setBuffer(bufferFrom(str, 'utf8'));\n        this.buf = (0, buffer_1.bufferFrom)(str, 'utf8');\n        this.touch();\n    };\n    Node.prototype.getBuffer = function () {\n        if (!this.buf)\n            this.setBuffer((0, buffer_1.bufferAllocUnsafe)(0));\n        return (0, buffer_1.bufferFrom)(this.buf); // Return a copy.\n    };\n    Node.prototype.setBuffer = function (buf) {\n        this.buf = (0, buffer_1.bufferFrom)(buf); // Creates a copy of data.\n        this.touch();\n    };\n    Node.prototype.getSize = function () {\n        return this.buf ? this.buf.length : 0;\n    };\n    Node.prototype.setModeProperty = function (property) {\n        this.mode = (this.mode & ~S_IFMT) | property;\n    };\n    Node.prototype.setIsFile = function () {\n        this.setModeProperty(S_IFREG);\n    };\n    Node.prototype.setIsDirectory = function () {\n        this.setModeProperty(S_IFDIR);\n    };\n    Node.prototype.setIsSymlink = function () {\n        this.setModeProperty(S_IFLNK);\n    };\n    Node.prototype.isFile = function () {\n        return (this.mode & S_IFMT) === S_IFREG;\n    };\n    Node.prototype.isDirectory = function () {\n        return (this.mode & S_IFMT) === S_IFDIR;\n    };\n    Node.prototype.isSymlink = function () {\n        // return !!this.symlink;\n        return (this.mode & S_IFMT) === S_IFLNK;\n    };\n    Node.prototype.makeSymlink = function (steps) {\n        this.symlink = steps;\n        this.setIsSymlink();\n    };\n    Node.prototype.write = function (buf, off, len, pos) {\n        if (off === void 0) { off = 0; }\n        if (len === void 0) { len = buf.length; }\n        if (pos === void 0) { pos = 0; }\n        if (!this.buf)\n            this.buf = (0, buffer_1.bufferAllocUnsafe)(0);\n        if (pos + len > this.buf.length) {\n            var newBuf = (0, buffer_1.bufferAllocUnsafe)(pos + len);\n            this.buf.copy(newBuf, 0, 0, this.buf.length);\n            this.buf = newBuf;\n        }\n        buf.copy(this.buf, pos, off, off + len);\n        this.touch();\n        return len;\n    };\n    // Returns the number of bytes read.\n    Node.prototype.read = function (buf, off, len, pos) {\n        if (off === void 0) { off = 0; }\n        if (len === void 0) { len = buf.byteLength; }\n        if (pos === void 0) { pos = 0; }\n        if (!this.buf)\n            this.buf = (0, buffer_1.bufferAllocUnsafe)(0);\n        var actualLen = len;\n        if (actualLen > buf.byteLength) {\n            actualLen = buf.byteLength;\n        }\n        if (actualLen + pos > this.buf.length) {\n            actualLen = this.buf.length - pos;\n        }\n        this.buf.copy(buf, off, pos, pos + actualLen);\n        return actualLen;\n    };\n    Node.prototype.truncate = function (len) {\n        if (len === void 0) { len = 0; }\n        if (!len)\n            this.buf = (0, buffer_1.bufferAllocUnsafe)(0);\n        else {\n            if (!this.buf)\n                this.buf = (0, buffer_1.bufferAllocUnsafe)(0);\n            if (len <= this.buf.length) {\n                this.buf = this.buf.slice(0, len);\n            }\n            else {\n                var buf = (0, buffer_1.bufferAllocUnsafe)(0);\n                this.buf.copy(buf);\n                buf.fill(0, len);\n            }\n        }\n        this.touch();\n    };\n    Node.prototype.chmod = function (perm) {\n        this.perm = perm;\n        this.mode = (this.mode & ~511) | perm;\n        this.touch();\n    };\n    Node.prototype.chown = function (uid, gid) {\n        this.uid = uid;\n        this.gid = gid;\n        this.touch();\n    };\n    Node.prototype.touch = function () {\n        this.mtime = new Date();\n        this.emit('change', this);\n    };\n    Node.prototype.canRead = function (uid, gid) {\n        if (uid === void 0) { uid = process_1.default.getuid(); }\n        if (gid === void 0) { gid = process_1.default.getgid(); }\n        if (this.perm & 4 /* IROTH */) {\n            return true;\n        }\n        if (gid === this.gid) {\n            if (this.perm & 32 /* IRGRP */) {\n                return true;\n            }\n        }\n        if (uid === this.uid) {\n            if (this.perm & 256 /* IRUSR */) {\n                return true;\n            }\n        }\n        return false;\n    };\n    Node.prototype.canWrite = function (uid, gid) {\n        if (uid === void 0) { uid = process_1.default.getuid(); }\n        if (gid === void 0) { gid = process_1.default.getgid(); }\n        if (this.perm & 2 /* IWOTH */) {\n            return true;\n        }\n        if (gid === this.gid) {\n            if (this.perm & 16 /* IWGRP */) {\n                return true;\n            }\n        }\n        if (uid === this.uid) {\n            if (this.perm & 128 /* IWUSR */) {\n                return true;\n            }\n        }\n        return false;\n    };\n    Node.prototype.del = function () {\n        this.emit('delete', this);\n    };\n    Node.prototype.toJSON = function () {\n        return {\n            ino: this.ino,\n            uid: this.uid,\n            gid: this.gid,\n            atime: this.atime.getTime(),\n            mtime: this.mtime.getTime(),\n            ctime: this.ctime.getTime(),\n            perm: this.perm,\n            mode: this.mode,\n            nlink: this.nlink,\n            symlink: this.symlink,\n            data: this.getString(),\n        };\n    };\n    return Node;\n}(events_1.EventEmitter));\nexports.Node = Node;\n/**\n * Represents a hard link that points to an i-node `node`.\n */\nvar Link = /** @class */ (function (_super) {\n    __extends(Link, _super);\n    function Link(vol, parent, name) {\n        var _this = _super.call(this) || this;\n        _this.children = {};\n        // Path to this node as Array: ['usr', 'bin', 'node'].\n        _this._steps = [];\n        // \"i-node\" number of the node.\n        _this.ino = 0;\n        // Number of children.\n        _this.length = 0;\n        _this.vol = vol;\n        _this.parent = parent;\n        _this.name = name;\n        _this.syncSteps();\n        return _this;\n    }\n    Object.defineProperty(Link.prototype, \"steps\", {\n        get: function () {\n            return this._steps;\n        },\n        // Recursively sync children steps, e.g. in case of dir rename\n        set: function (val) {\n            this._steps = val;\n            for (var _i = 0, _a = Object.values(this.children); _i < _a.length; _i++) {\n                var child = _a[_i];\n                child === null || child === void 0 ? void 0 : child.syncSteps();\n            }\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Link.prototype.setNode = function (node) {\n        this.node = node;\n        this.ino = node.ino;\n    };\n    Link.prototype.getNode = function () {\n        return this.node;\n    };\n    Link.prototype.createChild = function (name, node) {\n        if (node === void 0) { node = this.vol.createNode(); }\n        var link = new Link(this.vol, this, name);\n        link.setNode(node);\n        if (node.isDirectory()) {\n            // link.setChild('.', link);\n            // link.getNode().nlink++;\n            // link.setChild('..', this);\n            // this.getNode().nlink++;\n        }\n        this.setChild(name, link);\n        return link;\n    };\n    Link.prototype.setChild = function (name, link) {\n        if (link === void 0) { link = new Link(this.vol, this, name); }\n        this.children[name] = link;\n        link.parent = this;\n        this.length++;\n        this.emit('child:add', link, this);\n        return link;\n    };\n    Link.prototype.deleteChild = function (link) {\n        delete this.children[link.getName()];\n        this.length--;\n        this.emit('child:delete', link, this);\n    };\n    Link.prototype.getChild = function (name) {\n        if (Object.hasOwnProperty.call(this.children, name)) {\n            return this.children[name];\n        }\n    };\n    Link.prototype.getPath = function () {\n        return this.steps.join(exports.SEP);\n    };\n    Link.prototype.getName = function () {\n        return this.steps[this.steps.length - 1];\n    };\n    // del() {\n    //     const parent = this.parent;\n    //     if(parent) {\n    //         parent.deleteChild(link);\n    //     }\n    //     this.parent = null;\n    //     this.vol = null;\n    // }\n    /**\n     * Walk the tree path and return the `Link` at that location, if any.\n     * @param steps {string[]} Desired location.\n     * @param stop {number} Max steps to go into.\n     * @param i {number} Current step in the `steps` array.\n     *\n     * @return {Link|null}\n     */\n    Link.prototype.walk = function (steps, stop, i) {\n        if (stop === void 0) { stop = steps.length; }\n        if (i === void 0) { i = 0; }\n        if (i >= steps.length)\n            return this;\n        if (i >= stop)\n            return this;\n        var step = steps[i];\n        var link = this.getChild(step);\n        if (!link)\n            return null;\n        return link.walk(steps, stop, i + 1);\n    };\n    Link.prototype.toJSON = function () {\n        return {\n            steps: this.steps,\n            ino: this.ino,\n            children: Object.keys(this.children),\n        };\n    };\n    Link.prototype.syncSteps = function () {\n        this.steps = this.parent ? this.parent.steps.concat([this.name]) : [this.name];\n    };\n    return Link;\n}(events_1.EventEmitter));\nexports.Link = Link;\n/**\n * Represents an open file (file descriptor) that points to a `Link` (Hard-link) and a `Node`.\n */\nvar File = /** @class */ (function () {\n    /**\n     * Open a Link-Node pair. `node` is provided separately as that might be a different node\n     * rather the one `link` points to, because it might be a symlink.\n     * @param link\n     * @param node\n     * @param flags\n     * @param fd\n     */\n    function File(link, node, flags, fd) {\n        /**\n         * A cursor/offset position in a file, where data will be written on write.\n         * User can \"seek\" this position.\n         */\n        this.position = 0;\n        this.link = link;\n        this.node = node;\n        this.flags = flags;\n        this.fd = fd;\n    }\n    File.prototype.getString = function (encoding) {\n        if (encoding === void 0) { encoding = 'utf8'; }\n        return this.node.getString();\n    };\n    File.prototype.setString = function (str) {\n        this.node.setString(str);\n    };\n    File.prototype.getBuffer = function () {\n        return this.node.getBuffer();\n    };\n    File.prototype.setBuffer = function (buf) {\n        this.node.setBuffer(buf);\n    };\n    File.prototype.getSize = function () {\n        return this.node.getSize();\n    };\n    File.prototype.truncate = function (len) {\n        this.node.truncate(len);\n    };\n    File.prototype.seekTo = function (position) {\n        this.position = position;\n    };\n    File.prototype.stats = function () {\n        return Stats_1.default.build(this.node);\n    };\n    File.prototype.write = function (buf, offset, length, position) {\n        if (offset === void 0) { offset = 0; }\n        if (length === void 0) { length = buf.length; }\n        if (typeof position !== 'number')\n            position = this.position;\n        if (this.flags & O_APPEND)\n            position = this.getSize();\n        var bytes = this.node.write(buf, offset, length, position);\n        this.position = position + bytes;\n        return bytes;\n    };\n    File.prototype.read = function (buf, offset, length, position) {\n        if (offset === void 0) { offset = 0; }\n        if (length === void 0) { length = buf.byteLength; }\n        if (typeof position !== 'number')\n            position = this.position;\n        var bytes = this.node.read(buf, offset, length, position);\n        this.position = position + bytes;\n        return bytes;\n    };\n    File.prototype.chmod = function (perm) {\n        this.node.chmod(perm);\n    };\n    File.prototype.chown = function (uid, gid) {\n        this.node.chown(uid, gid);\n    };\n    return File;\n}());\nexports.File = File;\n"]},"metadata":{},"sourceType":"script"}